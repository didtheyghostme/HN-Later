(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();try{}catch(e){console.error("[wxt] Failed to initialize plugins",e)}const N=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome,O=N,p=(e,t)=>t.some(n=>e instanceof n);let L,B;function k(){return L||(L=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function R(){return B||(B=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const b=new WeakMap,h=new WeakMap,m=new WeakMap;function F(e){const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{n(d(e.result)),o()},i=()=>{r(e.error),o()};e.addEventListener("success",s),e.addEventListener("error",i)});return m.set(t,e),t}function V(e){if(b.has(e))return;const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{n(),o()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});b.set(e,t)}let g={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return b.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return d(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function T(e){g=e(g)}function W(e){return R().includes(e)?function(...t){return e.apply(I(this),t),d(this.request)}:function(...t){return d(e.apply(I(this),t))}}function K(e){return typeof e=="function"?W(e):(e instanceof IDBTransaction&&V(e),p(e,k())?new Proxy(e,g):e)}function d(e){if(e instanceof IDBRequest)return F(e);if(h.has(e))return h.get(e);const t=K(e);return t!==e&&(h.set(e,t),m.set(t,e)),t}const I=e=>m.get(e);function U(e,t,{blocked:n,upgrade:r,blocking:o,terminated:s}={}){const i=indexedDB.open(e,t),u=d(i);return r&&i.addEventListener("upgradeneeded",a=>{r(d(i.result),a.oldVersion,a.newVersion,d(i.transaction),a)}),n&&i.addEventListener("blocked",a=>n(a.oldVersion,a.newVersion,a)),u.then(a=>{s&&a.addEventListener("close",()=>s()),o&&a.addEventListener("versionchange",c=>o(c.oldVersion,c.newVersion,c))}).catch(()=>{}),u}const H=["get","getKey","getAll","getAllKeys","count"],q=["put","add","delete","clear"],y=new Map;function C(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(y.get(t))return y.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=q.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||H.includes(n)))return;const s=async function(i,...u){const a=this.transaction(i,o?"readwrite":"readonly");let c=a.store;return r&&(c=c.index(u.shift())),(await Promise.all([c[n](...u),o&&a.done]))[0]};return y.set(t,s),s}T(e=>({...e,get:(t,n,r)=>C(t,n)||e.get(t,n,r),has:(t,n)=>!!C(t,n)||e.has(t,n)}));const J=["continue","continuePrimaryKey","advance"],M={},v=new WeakMap,S=new WeakMap,_={get(e,t){if(!J.includes(t))return e[t];let n=M[t];return n||(n=M[t]=function(...r){v.set(this,S.get(this)[t](...r))}),n}};async function*z(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,_);for(S.set(n,t),m.set(n,I(t));t;)yield n,t=await(v.get(n)||t.continue()),v.delete(n)}function P(e,t){return t===Symbol.asyncIterator&&p(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&p(e,[IDBIndex,IDBObjectStore])}T(e=>({...e,get(t,n,r){return P(t,n)?z:e.get(t,n,r)},has(t,n){return P(t,n)||e.has(t,n)}}));let w=null;function E(){return w||(w=U("hn-later",1,{upgrade(e){e.createObjectStore("stories",{keyPath:"id"}).createIndex("by-savedAt","savedAt")}})),w}async function G(e){await(await E()).delete("stories",e)}async function D(){return(await(await E()).getAllFromIndex("stories","by-savedAt")).reverse()}async function Q(){const e=await D();return JSON.stringify({version:1,stories:e},null,2)}async function X(e){const t=JSON.parse(e);if(t.version!==1||!Array.isArray(t.stories))throw new Error("Invalid backup format");const n=await E();let r=0;for(const o of t.stories)await n.put("stories",o),r++;return r}const l=document.getElementById("list"),Y=document.getElementById("empty"),Z=document.getElementById("export-btn"),x=document.getElementById("import-input");function ee(e){const t=Math.floor((Date.now()-e)/1e3);if(t<60)return"just now";const n=Math.floor(t/60);if(n<60)return`${n}m ago`;const r=Math.floor(n/60);return r<24?`${r}h ago`:`${Math.floor(r/24)}d ago`}function te(e){return e.totalComments===0?0:Math.round(e.readComments.length/e.totalComments*100)}function ne(e){return Math.max(0,e.totalComments-e.seenComments.length)}function re(e){const t=te(e),n=ne(e),r=document.createElement("div");return r.className="story-item",r.innerHTML=`
    <div class="story-title">
      <a href="${e.url}" target="_blank" title="${e.title}">${e.title}</a>
    </div>
    <div class="story-meta">
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${t}%"></div>
        </div>
        <span class="progress-text">${t}%</span>
      </div>
      ${n>0?`<span class="new-badge">${n} new</span>`:""}
      <span>${ee(e.savedAt)}</span>
    </div>
    <div class="story-actions">
      <button class="btn btn-primary continue-btn" data-url="${e.hnUrl}">
        ▶ Continue
      </button>
      <button class="btn btn-secondary remove-btn" data-id="${e.id}">
        ✕ Remove
      </button>
    </div>
  `,r.querySelector(".continue-btn").addEventListener("click",o=>{const s=o.currentTarget.dataset.url;O.runtime.sendMessage({type:"OPEN_THREAD",url:s}),window.close()}),r.querySelector(".remove-btn").addEventListener("click",async o=>{const s=o.currentTarget.dataset.id;await G(s),await $(),r.remove(),A()}),r}function A(){const e=l.children.length>0;l.hidden=!e,Y.hidden=e}async function $(){const e=await D();await O.storage.local.set({itemCount:e.length})}async function j(){const e=await D();l.innerHTML="";for(const t of e)l.appendChild(re(t));A()}function f(e){let t=document.querySelector(".toast");t||(t=document.createElement("div"),t.className="toast",document.body.appendChild(t)),t.textContent=e,t.classList.add("show"),setTimeout(()=>t?.classList.remove("show"),2e3)}Z.addEventListener("click",async()=>{try{const e=await Q(),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`hn-later-backup-${new Date().toISOString().split("T")[0]}.json`,r.click(),URL.revokeObjectURL(n),f("Data exported!")}catch(e){f("Export failed"),console.error(e)}});x.addEventListener("change",async e=>{const t=e.target.files?.[0];if(t){try{const n=await t.text(),r=await X(n);await $(),await j(),f(`Imported ${r} stories!`)}catch(n){f("Import failed - invalid file"),console.error(n)}x.value=""}});j();

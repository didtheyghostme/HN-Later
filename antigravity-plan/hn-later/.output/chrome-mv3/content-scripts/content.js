var content=(function(){"use strict";function J(e){return e}const u=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;async function S(e){const t=await u.runtime.sendMessage({type:"SAVE_ITEM",item:e});if(!t.success)throw new Error(t.error)}async function E(e){const t=await u.runtime.sendMessage({type:"REMOVE_ITEM",storyId:e});if(!t.success)throw new Error(t.error)}async function k(e){const t=await u.runtime.sendMessage({type:"GET_ITEM",storyId:e});if(!t.success)throw new Error(t.error);return t.item}async function b(e){const t=await u.runtime.sendMessage({type:"IS_SAVED",storyId:e});if(!t.success)throw new Error(t.error);return t.saved}async function x(e,t,n){const o=await u.runtime.sendMessage({type:"UPDATE_CHECKPOINT",storyId:e,checkpointCommentId:t,totalComments:n});if(!o.success)throw new Error(o.error)}async function N(e){const t=await u.runtime.sendMessage({type:"GET_PROGRESS",storyId:e});if(!t.success)throw new Error(t.error);return t.progress}const q={matches:["*://news.ycombinator.com/*"],main(){const e=window.location.pathname==="/item",t=new URLSearchParams(window.location.search).get("id");e&&t&&(R(t),W(t)),e&&(document.body.classList.add("hn-later-item-page"),$()),A()}};async function A(){const e=document.querySelectorAll("tr.athing:not(.comtr)"),t=new URLSearchParams(window.location.search).get("id"),n=window.location.pathname==="/item";for(const o of e){const s=o.id;if(!s||n&&s===t)continue;const r=o.nextElementSibling?.querySelector("td.subtext");if(!r)continue;const a=r.querySelectorAll("a");if(!Array.from(a).find(h=>h.href.includes("item?id=")))continue;const d=document.createElement("a");d.href="#",d.className="hn-later-save-link",d.dataset.storyId=s;const l=await b(s);m(d,l),d.addEventListener("click",async h=>{h.preventDefault(),await M(d,o)});const w=document.createElement("span");w.className="hn-later-save-container",w.innerHTML=" | ",w.appendChild(d),r.appendChild(w)}}function m(e,t){e.textContent=t?"saved âœ“":"save",e.classList.toggle("saved",t)}async function M(e,t){const n=e.dataset.storyId;if(e.classList.contains("saved"))await E(n),m(e,!1);else{const i=t.querySelector("td.title:last-child")?.querySelector("a.titleline > a, span.titleline > a");if(!i)return;const r=i.textContent||"Untitled",a=i.href,c=`https://news.ycombinator.com/item?id=${n}`,h=(t.nextElementSibling?.querySelector('a[href*="item?id="]')?.textContent||"").match(/(\d+)\s*comment/),O=h?parseInt(h[1],10):0;await S({id:n,title:r,url:a,hnUrl:c,totalComments:O}),m(e,!0)}}async function R(e){await P(e);const t=await k(e);t&&T(e,t.checkpointTimestamp)}async function P(e){const t=document.querySelector("td.subtext");if(!t)return;const n=t.querySelectorAll("a"),o=n[n.length-1];if(!o)return;const s=document.createElement("a");s.href="#",s.className="hn-later-save-link",s.dataset.storyId=e;const i=await b(e);m(s,i),s.addEventListener("click",async a=>{a.preventDefault(),await U(s,e)});const r=document.createTextNode(" | ");o.after(r,s)}async function U(e,t){if(e.classList.contains("saved"))await E(t),m(e,!1),F();else{const o=document.querySelector(".titleline > a, .storylink"),s=o?.textContent||"Untitled",i=o?.href||window.location.href,r=window.location.href,c=document.querySelectorAll("tr.athing.comtr").length;await S({id:t,title:s,url:i,hnUrl:r,totalComments:c}),m(e,!0),T(t,null)}}function F(){document.querySelector(".hn-later-scrollbar")?.remove(),document.querySelector(".hn-later-buttons")?.remove(),document.querySelectorAll(".hn-later-new-label").forEach(e=>e.remove())}async function T(e,t){const n=document.querySelectorAll("tr.athing.comtr");if(n.length===0)return;const s=(await N(e))?.checkpointCommentId??null;if(t&&D(n,t),V(n,s),_(e,n),window.location.hash==="#hn-later-continue"&&s){const i=document.getElementById(s);i&&(i.scrollIntoView({behavior:"smooth",block:"start"}),history.replaceState(null,"",window.location.pathname+window.location.search))}}function D(e,t){e.forEach(n=>{const o=n.querySelector(".age a");if(!o)return;const s=o.getAttribute("title");if(!s)return;if(new Date(s).getTime()>t){const r=document.createElement("span");r.className="hn-later-new-label",r.textContent="[NEW]",o.after(r),n.classList.add("hn-later-new")}})}let f=null;const I=new Map;function V(e,t){f=document.createElement("div"),f.className="hn-later-scrollbar";const n=document.createElement("div");n.className="hn-later-viewport",f.appendChild(n);const o=document.documentElement.scrollHeight;let s=t===null;e.forEach(r=>{const a=r.id,d=(r.getBoundingClientRect().top+window.scrollY)/o,l=document.createElement("div");l.className="hn-later-marker",l.dataset.commentId=a,r.classList.contains("hn-later-new")?l.classList.add("new"):s?l.classList.add("unread"):l.classList.add("read"),a===t&&(s=!0),l.style.top=`${d*100}%`,l.addEventListener("click",()=>{r.scrollIntoView({behavior:"smooth",block:"center"})}),f.appendChild(l),I.set(a,l)}),document.body.appendChild(f);const i=()=>{const r=window.scrollY,a=window.innerHeight,c=document.documentElement.scrollHeight;n.style.top=`${r/c*100}%`,n.style.height=`${a/c*100}%`};window.addEventListener("scroll",i,{passive:!0}),i()}function _(e,t){const n=document.createElement("div");n.className="hn-later-buttons";const o=document.createElement("button");o.className="hn-later-btn checkpoint",o.innerHTML="ðŸ“ Checkpoint",o.title="Save reading position",o.addEventListener("click",()=>H(e,t));const s=document.createElement("button");s.className="hn-later-btn next-topic",s.innerHTML="â­ï¸ Next Topic",s.title="Jump to next top-level comment",s.addEventListener("click",()=>B(t)),n.appendChild(o),n.appendChild(s),document.body.appendChild(n)}function $(){document.querySelectorAll("tr.athing.comtr").forEach(t=>{t.style.position="relative";const n=document.createElement("button");n.className="hn-later-collapse-btn",n.textContent="â–¼",n.title="Collapse thread",n.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();const s=t.querySelector(".togg");if(s){s.click();const i=s.textContent?.includes("+");n.textContent=i?"â–²":"â–¼"}}),t.appendChild(n)})}async function H(e,t){let n=null;for(const o of t){const s=o.getBoundingClientRect();if(s.top>=0&&s.top<window.innerHeight/2){n=o;break}}if(!n){for(const o of t)if(o.getBoundingClientRect().bottom>0){n=o;break}}if(n){await x(e,n.id,t.length),y("ðŸ“ Checkpoint saved!");let o=!1;t.forEach(s=>{const i=I.get(s.id);i&&!i.classList.contains("new")&&(o?(i.classList.remove("read"),i.classList.add("unread")):(i.classList.remove("unread"),i.classList.add("read"))),s.id===n.id&&(o=!0)})}}function B(e){const t=window.scrollY;for(const n of e){const o=n.querySelector(".ind img");if((o?parseInt(o.getAttribute("width")||"0",10):0)===0&&n.getBoundingClientRect().top+window.scrollY>t+100){n.scrollIntoView({behavior:"smooth",block:"start"});break}}}function y(e){let t=document.querySelector(".hn-later-toast");t||(t=document.createElement("div"),t.className="hn-later-toast",document.body.appendChild(t)),t.textContent=e,t.classList.add("show"),setTimeout(()=>t?.classList.remove("show"),2e3)}function W(e){document.addEventListener("keydown",async t=>{if((t.metaKey||t.ctrlKey)&&t.shiftKey&&t.key.toLowerCase()==="s")if(t.preventDefault(),t.stopPropagation(),await b(e)){await E(e),y("ðŸ“š Removed from saved");const o=document.querySelector(".hn-later-save-link");o&&(o.textContent="save",o.classList.remove("saved")),document.querySelector(".hn-later-scrollbar")?.remove(),document.querySelector(".hn-later-buttons")?.remove()}else{const o=document.querySelector(".titleline > a, .storylink"),s=o?.textContent||"Untitled",i=o?.href||window.location.href,r=window.location.href,a=document.querySelectorAll("tr.athing.comtr");await S({id:e,title:s,url:i,hnUrl:r,totalComments:a.length}),y("ðŸ“Œ Saved for later (Cmd+Shift+S)");const c=document.querySelector(".hn-later-save-link");c&&(c.textContent="saved âœ“",c.classList.add("saved")),await k(e)&&!document.querySelector(".hn-later-scrollbar")&&window.location.reload()}})}function p(e,...t){}const Y={debug:(...e)=>p(console.debug,...e),log:(...e)=>p(console.log,...e),warn:(...e)=>p(console.warn,...e),error:(...e)=>p(console.error,...e)};class C extends Event{constructor(t,n){super(C.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}static EVENT_NAME=L("wxt:locationchange")}function L(e){return`${u?.runtime?.id}:content:${e}`}function G(e){let t,n;return{run(){t==null&&(n=new URL(location.href),t=e.setInterval(()=>{let o=new URL(location.href);o.href!==n.href&&(window.dispatchEvent(new C(o,n)),n=o)},1e3))}}}class g{constructor(t,n){this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}static SCRIPT_STARTED_MESSAGE_TYPE=L("wxt:content-script-started");isTopFrame=window.self===window.top;abortController;locationWatcher=G(this);receivedMessageIds=new Set;get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return u.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const o=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(o)),o}setTimeout(t,n){const o=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(o)),o}requestAnimationFrame(t){const n=requestAnimationFrame((...o)=>{this.isValid&&t(...o)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const o=requestIdleCallback((...s)=>{this.signal.aborted||t(...s)},n);return this.onInvalidated(()=>cancelIdleCallback(o)),o}addEventListener(t,n,o,s){n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),t.addEventListener?.(n.startsWith("wxt:")?L(n):n,o,{...s,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),Y.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:g.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){const n=t.data?.type===g.SCRIPT_STARTED_MESSAGE_TYPE,o=t.data?.contentScriptName===this.contentScriptName,s=!this.receivedMessageIds.has(t.data?.messageId);return n&&o&&s}listenForNewerScripts(t){let n=!0;const o=s=>{if(this.verifyScriptStartedEvent(s)){this.receivedMessageIds.add(s.data.messageId);const i=n;if(n=!1,i&&t?.ignoreFirstEvent)return;this.notifyInvalidated()}};addEventListener("message",o),this.onInvalidated(()=>removeEventListener("message",o))}}function z(){}function v(e,...t){}const K={debug:(...e)=>v(console.debug,...e),log:(...e)=>v(console.log,...e),warn:(...e)=>v(console.warn,...e),error:(...e)=>v(console.error,...e)};return(async()=>{try{const{main:e,...t}=q,n=new g("content",t);return await e(n)}catch(e){throw K.error('The content script "content" crashed on startup!',e),e}})()})();
content;
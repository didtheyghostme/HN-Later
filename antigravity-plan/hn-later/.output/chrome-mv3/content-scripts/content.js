var content=(function(){"use strict";function O(e){return e}const d=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;async function E(e){const t=await d.runtime.sendMessage({type:"SAVE_ITEM",item:e});if(!t.success)throw new Error(t.error)}async function S(e){const t=await d.runtime.sendMessage({type:"REMOVE_ITEM",storyId:e});if(!t.success)throw new Error(t.error)}async function I(e){const t=await d.runtime.sendMessage({type:"GET_ITEM",storyId:e});if(!t.success)throw new Error(t.error);return t.item}async function b(e){const t=await d.runtime.sendMessage({type:"IS_SAVED",storyId:e});if(!t.success)throw new Error(t.error);return t.saved}async function k(e,t,n){const o=await d.runtime.sendMessage({type:"UPDATE_CHECKPOINT",storyId:e,checkpointCommentId:t,totalComments:n});if(!o.success)throw new Error(o.error)}async function L(e){const t=await d.runtime.sendMessage({type:"GET_PROGRESS",storyId:e});if(!t.success)throw new Error(t.error);return t.progress}const x={matches:["*://news.ycombinator.com/*"],main(){const e=window.location.pathname==="/item",t=new URLSearchParams(window.location.search).get("id");e&&t&&M(t),e&&_(),N()}};async function N(){const e=document.querySelectorAll("tr.athing:not(.comtr)");for(const t of e){const n=t.id;if(!n)continue;const s=t.nextElementSibling?.querySelector("td.subtext");if(!s)continue;const i=s.querySelectorAll("a"),r=Array.from(i).find(c=>c.href.includes("item?id="));if(!r)continue;const a=document.createElement("a");a.href="#",a.className="hn-later-save-link",a.dataset.storyId=n;const l=await b(n);u(a,l),a.addEventListener("click",async c=>{c.preventDefault(),await A(a,t)});const p=document.createTextNode(" | ");r.after(p,a)}}function u(e,t){e.textContent=t?"saved âœ“":"save",e.classList.toggle("saved",t)}async function A(e,t){const n=e.dataset.storyId;if(e.classList.contains("saved"))await S(n),u(e,!1);else{const i=t.querySelector("td.title:last-child")?.querySelector("a.titleline > a, span.titleline > a");if(!i)return;const r=i.textContent||"Untitled",a=i.href,l=`https://news.ycombinator.com/item?id=${n}`,T=(t.nextElementSibling?.querySelector('a[href*="item?id="]')?.textContent||"").match(/(\d+)\s*comment/),G=T?parseInt(T[1],10):0;await E({id:n,title:r,url:a,hnUrl:l,totalComments:G}),u(e,!0)}}async function M(e){await q(e);const t=await I(e);t&&y(e,t.checkpointTimestamp)}async function q(e){const t=document.querySelector("td.subtext");if(!t)return;const n=t.querySelectorAll("a"),o=n[n.length-1];if(!o)return;const s=document.createElement("a");s.href="#",s.className="hn-later-save-link",s.dataset.storyId=e;const i=await b(e);u(s,i),s.addEventListener("click",async a=>{a.preventDefault(),await R(s,e)});const r=document.createTextNode(" | ");o.after(r,s)}async function R(e,t){if(e.classList.contains("saved"))await S(t),u(e,!1),P();else{const o=document.querySelector(".titleline > a, .storylink"),s=o?.textContent||"Untitled",i=o?.href||window.location.href,r=window.location.href,l=document.querySelectorAll("tr.athing.comtr").length;await E({id:t,title:s,url:i,hnUrl:r,totalComments:l}),u(e,!0),y(t,null)}}function P(){document.querySelector(".hn-later-scrollbar")?.remove(),document.querySelector(".hn-later-buttons")?.remove(),document.querySelectorAll(".hn-later-new-label").forEach(e=>e.remove())}async function y(e,t){const n=document.querySelectorAll("tr.athing.comtr");if(n.length===0)return;const s=(await L(e))?.checkpointCommentId??null;if(t&&F(n,t),U(n,s),V(e,n),window.location.hash==="#hn-later-continue"&&s){const i=document.getElementById(s);i&&(i.scrollIntoView({behavior:"smooth",block:"start"}),history.replaceState(null,"",window.location.pathname+window.location.search))}}function F(e,t){e.forEach(n=>{const o=n.querySelector(".age a");if(!o)return;const s=o.getAttribute("title");if(!s)return;if(new Date(s).getTime()>t){const r=document.createElement("span");r.className="hn-later-new-label",r.textContent="[NEW]",o.after(r),n.classList.add("hn-later-new")}})}let m=null;const C=new Map;function U(e,t){m=document.createElement("div"),m.className="hn-later-scrollbar";const n=document.createElement("div");n.className="hn-later-viewport",m.appendChild(n);const o=document.documentElement.scrollHeight;let s=t===null;e.forEach(r=>{const a=r.id,p=(r.getBoundingClientRect().top+window.scrollY)/o,c=document.createElement("div");c.className="hn-later-marker",c.dataset.commentId=a,r.classList.contains("hn-later-new")?c.classList.add("new"):s?c.classList.add("unread"):c.classList.add("read"),a===t&&(s=!0),c.style.top=`${p*100}%`,c.addEventListener("click",()=>{r.scrollIntoView({behavior:"smooth",block:"center"})}),m.appendChild(c),C.set(a,c)}),document.body.appendChild(m);const i=()=>{const r=window.scrollY,a=window.innerHeight,l=document.documentElement.scrollHeight;n.style.top=`${r/l*100}%`,n.style.height=`${a/l*100}%`};window.addEventListener("scroll",i,{passive:!0}),i()}function V(e,t){const n=document.createElement("div");n.className="hn-later-buttons";const o=document.createElement("button");o.className="hn-later-btn checkpoint",o.innerHTML="ðŸ“ Checkpoint",o.title="Save reading position",o.addEventListener("click",()=>$(e,t));const s=document.createElement("button");s.className="hn-later-btn next-topic",s.innerHTML="â­ï¸ Next Topic",s.title="Jump to next top-level comment",s.addEventListener("click",()=>D(t)),n.appendChild(o),n.appendChild(s),document.body.appendChild(n)}function _(){document.querySelectorAll("tr.athing.comtr").forEach(t=>{t.style.position="relative";const n=document.createElement("button");n.className="hn-later-collapse-btn",n.textContent="â–¼",n.title="Collapse thread",n.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();const s=t.querySelector(".togg");if(s){s.click();const i=s.textContent?.includes("+");n.textContent=i?"â–²":"â–¼"}}),t.appendChild(n)})}async function $(e,t){let n=null;for(const o of t){const s=o.getBoundingClientRect();if(s.top>=0&&s.top<window.innerHeight/2){n=o;break}}if(!n){for(const o of t)if(o.getBoundingClientRect().bottom>0){n=o;break}}if(n){await k(e,n.id,t.length),B("ðŸ“ Checkpoint saved!");let o=!1;t.forEach(s=>{const i=C.get(s.id);i&&!i.classList.contains("new")&&(o?(i.classList.remove("read"),i.classList.add("unread")):(i.classList.remove("unread"),i.classList.add("read"))),s.id===n.id&&(o=!0)})}}function D(e){const t=window.scrollY;for(const n of e){const o=n.querySelector(".ind img");if((o?parseInt(o.getAttribute("width")||"0",10):0)===0&&n.getBoundingClientRect().top+window.scrollY>t+100){n.scrollIntoView({behavior:"smooth",block:"start"});break}}}function B(e){let t=document.querySelector(".hn-later-toast");t||(t=document.createElement("div"),t.className="hn-later-toast",document.body.appendChild(t)),t.textContent=e,t.classList.add("show"),setTimeout(()=>t?.classList.remove("show"),2e3)}function h(e,...t){}const H={debug:(...e)=>h(console.debug,...e),log:(...e)=>h(console.log,...e),warn:(...e)=>h(console.warn,...e),error:(...e)=>h(console.error,...e)};class g extends Event{constructor(t,n){super(g.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}static EVENT_NAME=v("wxt:locationchange")}function v(e){return`${d?.runtime?.id}:content:${e}`}function W(e){let t,n;return{run(){t==null&&(n=new URL(location.href),t=e.setInterval(()=>{let o=new URL(location.href);o.href!==n.href&&(window.dispatchEvent(new g(o,n)),n=o)},1e3))}}}class f{constructor(t,n){this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}static SCRIPT_STARTED_MESSAGE_TYPE=v("wxt:content-script-started");isTopFrame=window.self===window.top;abortController;locationWatcher=W(this);receivedMessageIds=new Set;get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return d.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const o=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(o)),o}setTimeout(t,n){const o=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(o)),o}requestAnimationFrame(t){const n=requestAnimationFrame((...o)=>{this.isValid&&t(...o)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const o=requestIdleCallback((...s)=>{this.signal.aborted||t(...s)},n);return this.onInvalidated(()=>cancelIdleCallback(o)),o}addEventListener(t,n,o,s){n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),t.addEventListener?.(n.startsWith("wxt:")?v(n):n,o,{...s,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),H.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:f.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){const n=t.data?.type===f.SCRIPT_STARTED_MESSAGE_TYPE,o=t.data?.contentScriptName===this.contentScriptName,s=!this.receivedMessageIds.has(t.data?.messageId);return n&&o&&s}listenForNewerScripts(t){let n=!0;const o=s=>{if(this.verifyScriptStartedEvent(s)){this.receivedMessageIds.add(s.data.messageId);const i=n;if(n=!1,i&&t?.ignoreFirstEvent)return;this.notifyInvalidated()}};addEventListener("message",o),this.onInvalidated(()=>removeEventListener("message",o))}}function K(){}function w(e,...t){}const Y={debug:(...e)=>w(console.debug,...e),log:(...e)=>w(console.log,...e),warn:(...e)=>w(console.warn,...e),error:(...e)=>w(console.error,...e)};return(async()=>{try{const{main:e,...t}=x,n=new f("content",t);return await e(n)}catch(e){throw Y.error('The content script "content" crashed on startup!',e),e}})()})();
content;